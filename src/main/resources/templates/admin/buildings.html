<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">

<head>
    <meta charset="UTF-8">
    <meta name="description" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- The above 4 meta tags *must* come first in the head; any other head content must come *after* these tags -->

    <!-- Title  -->
    <title>Tạo mới bất động sản</title>

    <!-- Favicon  -->
    <link rel="icon" th:href="@{/img/core-img/favicon.ico}">
    <!-- Style CSS -->
    <link rel="stylesheet" th:href="@{/style.css}">
    <script th:src="@{/js/mi/location.js}"></script>
    <script th:src="@{/js/mi/home.js}"></script>
    <script th:src="@{/js/mi/buildings.js}"></script>
    <script th:src="@{/js/jquery/jquery-2.2.4.min.js}"></script>
    <script th:src="@{/ckeditor/ckeditor.js}"></script>
    <script th:src="@{/js/mi/base.js}"></script>

</head>
<body onload="generatedProvince();genBuildingCategory()">


<!-- ##### Header Area Start ##### -->
<div th:replace="common/header :: header"></div>
<!-- ##### Header Area End ##### -->

<!-- ##### Editor Area Start ##### -->
<section class="south-contact-area section-padding-100">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <div class="contact-heading">
                    <h6>Buildings info</h6>
                </div>
            </div>
        </div>

        <div class="row">

            <!-- Contact Form Area -->
            <div class="col-12 col-lg-12">
                <div class="contact-form">
                    <form method="post" action="" id="fileUploadForm" enctype="multipart/form-data">
                        <div class="alert alert-primary" role="alert" style="display: none" id="alert">
                            Đã xảy ra lỗi trong quá trình xử lí! vui lòng thử lại
                        </div>
                        <div class="form-group">
                            <input type="text" class="form-control" name="name" id="name"
                                   placeholder="Tên bất động sản">
                        </div>

                        <div class="form-group">
                            <input type="text" class="form-control" name="title" id="title"
                                   placeholder="Tiêu đề">
                        </div>

                        <div class="form-group">
                            <div class="row">
                                <div class="col-12 col-md-4 col-lg-3">
                                    <div class="form-group">
                                        <input type="number" class="form-control" name="car_park" id="car_park"
                                               placeholder="Gara ôtô (m2)">
                                    </div>
                                </div>

                                <div class="col-12 col-md-4 col-lg-3">
                                    <div class="form-group">
                                        <input type="number" class="form-control" name="moto_park" id="moto_park"
                                               placeholder="Gara môtô (m2)">
                                    </div>
                                </div>
                                <div class="col-12 col-md-4 col-lg-3">
                                    <div class="form-group">
                                        <input type="number" class="form-control" name="floor_area" id="floor_area"
                                               placeholder="Diện tích sàn">
                                    </div>
                                </div>

                                <div class="col-12 col-md-4 col-lg-3">
                                    <div class="form-group">
                                        <input type="number" class="form-control" name="home_frontage"
                                               id="home_frontage"
                                               placeholder="Diện tích mặt tiền">
                                    </div>
                                </div>

                                <div class="col-12 col-md-4 col-lg-3">
                                    <div class="form-group">
                                        <input type="number" class="form-control" name="campus_area" id="campus_area"
                                               placeholder="diện tích khuân viên">
                                    </div>
                                </div>
                            </div>
                        </div>


                        <div class="form-group">
                            <div class="row">
                                <div class="col-12 col-md-4 col-lg-3">
                                    <div class="form-group">
                                        <input type="number" class="form-control" name="bedroom" id="bedroom"
                                               placeholder="Số phòng ngủ">
                                    </div>
                                </div>


                                <div class="col-12 col-md-4 col-lg-3">
                                    <div class="form-group">
                                        <input type="number" class="form-control" name="function_room"
                                               id="function_room"
                                               placeholder="Số phòng chức năng">
                                    </div>
                                </div>

                                <div class="col-12 col-md-4 col-lg-3">
                                    <div class="form-group">
                                        <input type="text" class="form-control" name="altar_room" id="altar_room"
                                               placeholder="Phòng thờ">
                                    </div>
                                </div>

                                <div class="col-12 col-md-4 col-lg-3">
                                    <div class="form-group">
                                        <input type="number" class="form-control" name="number_floor" id="number_floor"
                                               placeholder="Số tầng">
                                    </div>
                                </div>

                                <div class="col-12 col-md-4 col-lg-3">
                                    <div class="form-group">
                                        <input type="number" class="form-control" name="frequence" id="frequence"
                                               placeholder="Tầng số">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <div class="row">
                                <div class="col-12 col-md-4 col-lg-3">
                                    <div class="form-group">
                                        <input type="number" class="form-control" name="electricity_price"
                                               id="electricity_price" placeholder="Giá điện">
                                    </div>
                                </div>

                                <div class="col-12 col-md-4 col-lg-3">
                                    <div class="form-group">
                                        <input type="number" class="form-control" name="water_price" id="water_price"
                                               placeholder="Giá nước">
                                    </div>
                                </div>

                                <div class="col-12 col-md-4 col-lg-3">
                                    <div class="form-group">
                                        <input type="number" class="form-control" name="service_price"
                                               id="service_price"
                                               placeholder="Giá dịch vụ">
                                    </div>
                                </div>

                                <div class="col-12 col-md-4 col-lg-3">
                                    <div class="form-group">
                                        <input type="number" class="form-control" name="price" id="price"
                                               placeholder="Giá bất động sản">
                                    </div>
                                </div>

                                <div class="col-12 col-md-4 col-lg-3">
                                    <div class="form-group">
                                        <input type="file" class="form-control" name="image" id="image">
                                    </div>
                                </div>

                            </div>
                        </div>

                        <div class="form-group">
                            <input type="text" class="form-control" name="map" id="map" placeholder="google map">
                        </div>

                        <div class="form-group">
                            <div class="row">
                                <div class="col-12 col-md-4 col-lg-3">
                                    <div class="form-group">
                                        <select class="form-control" style="padding: 6px" name="direction">
                                            <option value="Chính Đông">Chính Đông</option>
                                            <option value="Đông Nam">Đông Nam</option>
                                            <option value="Chính Nam">Chính Nam</option>
                                            <option value="Tây Nam">Tây Nam</option>
                                            <option value="Chính Tây">Chính Tây</option>
                                            <option value="Tây Bắc">Tây Bắc</option>
                                            <option value="Chính Bắc">Chính Bắc</option>
                                            <option value="Đông Bắc">Đông Bắc</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="col-12 col-md-4 col-lg-3">
                                    <div class="form-group">
                                        <select class="form-control" id="saleRent" name="sale_rent"
                                                style="padding: 6px">
                                            <option value="1">Đăng bắn</option>
                                            <option value="0">Đăng cho thuê</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="col-12 col-md-4 col-lg-3">
                                    <div class="form-group" id="building">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="row">
                                <div class="col-12 col-md-4 col-lg-3">
                                    <div class="form-group" id="provinces">
                                    </div>
                                </div>

                                <div class="col-12 col-md-4 col-lg-3">
                                    <div class="form-group" id="districts">

                                    </div>
                                </div>

                                <div class="col-12 col-md-4 col-lg-3">
                                    <div class="form-group" id="wards">

                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-group" style="margin-top: 10px">
                            <input type="text" class="form-control" name="address" id="address"
                                   placeholder="Địa chỉ chi tiết">
                        </div>

                        <div class="form-group" style="margin-top: 30px">
                            <textarea class="form-control" name="description" id="description" cols="30" rows="10"
                                      placeholder="Mô tẩ bất động sản"></textarea>

                            <input type="hidden" id="images" name="images">

                            <button type="button" id="btnSubmit" class="btn south-btn">Thêm mới</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    </div>
</section>
<!-- ##### Editor Area End ##### -->

<script th:src="@{/js/bootstrap.min.js}"></script>
<script>
    CKEDITOR.replace('description');
</script>

<script>
    $(document).ready(function () {

        $("#btnSubmit").click(function (event) {

            //stop submit the form, we will post it manually.
            event.preventDefault();

            // Get form
            var form = $('#fileUploadForm')[0];

            // Create an FormData object
            var data = new FormData(form);

            // disabled the submit button
            $("#btnSubmit").prop("disabled", true);

            $.ajax({
                type: "POST",
                enctype: 'multipart/form-data',
                url: "/images/load",
                data: data,
                processData: false,
                contentType: false,
                cache: false,
                timeout: 600000,
                success: function (data) {

                    var mota = CKEDITOR.instances.description.getData();
                    console.log(mota);
                    var building = $('#fileUploadForm').serializeArray();
                    building.push({name: 'images', value: data.data});
                    building.push({name: 'description', value: mota});
                    building = mapToJson(building);
                    console.log(building);
                    $.ajax({
                        url: '/buildings',
                        type: 'POST',
                        contentType: 'application/json', //dinh nghia kieu du lieu gui ve server
                        dataType: 'JSON', //dinh nghi kieu du lieu server gui len
                        data: building,
                        headers: {
                            Authorization: 'Bearer ' + document.cookie
                        },
                        success: function (result) { // result la ket qua server tra ve
                            // window.location = "/admin/buildings-categories";
                        },
                        error: function (result) {
                            $('#alert').css('display', '')
                        }
                    });
                },
                error: function (e) {
                    $('#alert').css('display', '')
                }
            });

        });

    });

    function mapToJson(data) {
        var o = {};
        $.each(data, function () {
            if (o[this.name]) {
                if (!o[this.name].push) {
                    o[this.name] = [o[this.name]];
                }
                o[this.name].push(this.value || '');
            } else {
                o[this.name] = this.value || '';
            }
        });
        return JSON.stringify(o);
    }
</script>
</body>

</html>